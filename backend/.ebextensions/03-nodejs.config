option_settings:
  aws:elasticbeanstalk:application:environment:
    CHROMIUM_PATH: /usr/bin/chromium-browser
    NODE_ENV: production
    
commands:
  01_node_update:
    command: "yum remove -y nodejs npm"
  02_install_node18:
    command: "curl -sL https://rpm.nodesource.com/setup_18.x | bash -"
  03_install_nodejs:
    command: "yum install -y nodejs"
  04_verify_node:
    command: "node --version"
    
files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_create_cache_dir.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Create cache directory for Puppeteer
      mkdir -p /home/ec2-user/.cache/puppeteer
      chown ec2-user:ec2-user /home/ec2-user/.cache/puppeteer