# apprunner.yaml (AWS App Runner Configuration)
version: 1.0

runtime: nodejs18

build:
  commands:
    # Install dependencies in backend folder
    - npm install --prefix backend --production
    # Clean npm cache to reduce deployment size  
    - npm cache clean --force

run:
  # Use the App Runner specific server
  command: node backend/server-apprunner.js
  network:
    port: 3002
    env_port: PORT
  env:
    - name: NODE_ENV
      value: production
    - name: PORT
      value: "3002"

healthcheck:
  path: /health
  protocol: HTTP
  port: 3002